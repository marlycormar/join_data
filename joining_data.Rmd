---
title: "Joining Data"
author: "Marly Cormar"
date: "6/20/2018"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE, message=FALSE)

# Assumptions: at least two files

```

``` {r open_libraries}

library(openxlsx)
library(gtools)
library(plyr)

```

```{r joining_data, results='asis'}

# Read CSV files in order
files <- c(dir("./data/", full.names = FALSE, pattern = ".xlsx$"))
files <- mixedsort(files, decreasing = TRUE)

#dates <- str_extract(list_files, "\\d{4}-\\d{2}-\\d{2}")

# Change column names to reflect week number
data <-list()
my_sep <- "_week"
for(i in 1:length(files)){
  data[[i]] <- read.xlsx(paste("./data/", files[i], sep=""))
  names(data[[i]]) <- c("USER_NAME", "UFID", "Section_No", paste("Logins", i, sep = my_sep) , paste("Hours", i, sep = my_sep), paste("PAGEVIEW", i, sep = my_sep), paste("SUBMISSION", i, sep = my_sep), paste("FILESVIEW", i, sep = my_sep), paste("CONVERSATION", i, sep = my_sep))
}

# Generate joined data
output <- join_all(data, by=c("USER_NAME","UFID", "Section_No"), type='left')

# Write joined data
write.xlsx(output, file="output/output.xlsx", sheetName="Joined forms")

cat("#### - The output has been generated")
```
